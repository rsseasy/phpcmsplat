var Calendar={curctl:null,wrap:null,time:!1,selregion:[(new Date).toString("yyyy-MM-dd").ParseDate(),0],dateregion:[(new Date).getFullYear()-60,(new Date).getFullYear()+20],value:new Date,create:function(){},show:function(){},init:function(){function l(){r.val(n.value.getFullYear());s.val(n.value.getMonth()+1);u.val(n.value.getHours());f.val(n.value.getMinutes());e.val(n.value.getSeconds())}var n=this,o,c,r,s,a,v,i,u,f,e,t,h;for(this.wrap=$('<div style="border:solid 1px blue; position:absolute; top:0px; left:0px;background:white; font-size:12px;display:none; padding-top:2px;z-Index:9999"><\/div>'),$(document.body).append(this.wrap),this.wrap.click(function(n){n.stopPropagation()}),$(document).click(function(){n.wrap.hide()}),n.show=function(){var f,e,t,u;for(n.value=n.curctl.val(),n.value=n.value?n.value.ParseDate():new Date,n.wrap.show(),r.empty(),f=n.dateregion[0],e=n.dateregion[1],t=f;t<=e;t++)r.append('<option value="'+t+'">'+t+"<\/option>");n.time?i.show():i.hide();n.create();u=n.curctl.offset();u.top+n.wrap.outerHeight()>=Math.max($(document.body).height(),$(window).height(),$(document).height())?u.top-=n.wrap.outerHeight():u.top+=n.curctl.outerHeight();n.wrap.css(u);l()},o=$('<div style="text-align:center;"><\/div>'),this.wrap.append(o),c=$('<div style="position:absolute; top:0px; left:0px; cursor:pointer;float:left;padding:3px;">&lt;<\/div>'),o.append(c),c.click(function(){if(n.value=n.value.GetPreMonth(),n.value.getFullYear()<n.dateregion[0])return n.value=n.value.GetNextMonth(),!1;l();n.create()}),r=$("<select>"),o.append(r),s=$("<select>"),o.append(s),t=1;t<13;t++)s.append('<option value="'+t+'">'+t+"<\/option>");for(r.change(function(){n.value=(r.val()+"-"+s.val()+"-01").ParseDate();n.create()}),s.change(function(){r.change()}),a=$('<div style="position:absolute; top:0px; right:0px; cursor:pointer;float:left;padding:3px;">&gt;<\/div>'),o.append(a),a.click(function(){if(n.value=n.value.GetNextMonth(),n.value.getFullYear()>n.dateregion[1])return n.value=n.value.GetPreMonth(),!1;l();n.create()}),v=$('<table style="text-align:center;vertical-align:middle;"><thead><tr><th>一<\/th><th>二<\/th><th>三<\/th><th>四<\/th><th>五<\/th><th>六<\/th><th>日<\/th><\/tr><\/thead><\/table>'),this.wrap.append(v),i=$('<div style="text-align:center;"><\/div>'),this.wrap.append(i),i.hide(),u="<select>",t=0;t<24;t++)u+='<option value="'+t+'">'+(t<10?"0":"")+t+"<\/option>";for(u+="<\/select>",u=$(u),i.append(u),u.change(function(){n.value=new Date(n.value.setHours(parseInt(this.value)));n.curctl.val(n.value.toString("yyyy-MM-dd HH:00:00"))}),i.append("时"),f="<select>",t=0;t<60;t++)f+='<option value="'+t+'">'+(t<10?"0":"")+t+"<\/option>";for(f+="<\/select>",f=$(f),i.append(f),f.change(function(){n.value=new Date(n.value.setMinutes(parseInt(this.value)));n.curctl.val(n.value.toString("yyyy-MM-dd HH:mm:00"))}),i.append("分"),e="<select>",t=0;t<60;t++)e+='<option value="'+t+'">'+(t<10?"0":"")+t+"<\/option>";e+="<\/select>";e=$(e);i.append(e);e.change(function(){n.value=new Date(n.value.setSeconds(parseInt(this.value)));n.curctl.val(n.value.toString("yyyy-MM-dd HH:mm:ss"));n.wrap.hide()});i.append("秒");n.create=function(){var c,r,t,l,a,e,i,o,s,u,f;for(h&&h.remove(),h=$("<tbody>"),v.append(h),c=n.value.GetFirstDayWeek(),r=[],t=1;t<c;t++)r.push("");for(l=n.value.GetMaxDay(),t=1;t<=l;t++)r.push(t);for(a=r.length,o=[],n.selregion[1]&&(u=n.selregion[0].toString("yyyy-MM-dd").ParseDate(),f=n.selregion[0].toString("yyyy-MM-dd").ParseDate(),n.selregion[1]<0?u=new Date(u.setDate(u.getDate()+n.selregion[1])):f=new Date(f.setDate(f.getDate()+n.selregion[1]))),t=0;t<a;t++)t%7==0&&(e=$("<tr>"),h.append(e)),i=$('<td style="padding:3px 4px;padding-top:4px; color:#aaaaa1;width:15px;text-align:center;">'+r[t]+"<\/td>"),e.append(i),s=n.value.toString("yyyy-MM-"+r[t]).ParseDate(),r[t]&&(!n.selregion[1]||s>=u&&s<=f)&&(i.css({cursor:"pointer",color:"black"}),o.push(i),i.mousemove(function(){var n=$(this);n.css({background:"gray",color:"black"})}),i.mouseout(function(){$.each(o,function(){var t=$(this);n.value.getDate()==parseInt(t.html())?t.css({background:"red",color:"white"}):t.css({background:"white",color:"black"})})}),i.click(function(){var t=parseInt(this.innerHTML);n.value=new Date(n.value.setDate(t));n.curctl.val(n.value.toString("yyyy-MM-dd"+(n.time?" HH:mm:ss":"")));n.time||(n.wrap.hide(),n.curctl.blur());$(this).mouseout()}));i.mouseout()}}};Calendar.init();$("[calendar]").each(function(){var n=$(this);!this.value&&n.attr("calendar").match(/^\d{4}/)&&n.val(n.attr("calendar"));n.focus(function(){n.attr("selregion")&&(Calendar.selregion=n.attr("selregion").split(","),Calendar.selregion[1]=parseInt(Calendar.selregion[1])||0);Calendar.time=n.attr("time");Calendar.curctl=n;Calendar.show()});n.click(function(n){n.stopPropagation()})})